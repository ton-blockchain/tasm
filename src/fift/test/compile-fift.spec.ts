import {compile} from "../compile"
import {compileCell} from "../../runtime"
import {readFileSync} from "node:fs"
import path from "node:path"

const test =
    (fift: string, expectedBoc: string): (() => void) =>
    () => {
        const fiftCell = compileCell(compile("test.fif", fift))
        expect(fiftCell.toBoc().toString("hex")).toEqual(expectedBoc)
    }

describe("Test Fift assembly compilation", () => {
    it(
        "should compile NFT collection",
        test(
            readFileSync(path.join(__dirname, "testdata", "NFTCollection.now.fif"), "utf8"),
            "b5ee9c7241020e0100024c000114ff00f4a413f4bcf2c80b01020162020703dcd0eda2edfbf891f24020d72c200000000ce302d72c2349e9ca848e3731ed44d001d70b3f01d431d431d74cf89201d0d30fd30ffa40d1c8cf850814ce8210a8cb00adcf0b8e14cb3fcb0f12cb0fcec98040fb00e0d72c2000000014e302d72c200000001ce30230840f01c700f2f403040600f831ed44d0fa40d33f20d431d74cf89224c705f2e19104d33f31d33ffa00d74c5324bbf2e1925324baf82804c8cb3f14cec9c8cf89880153815cf90001f9005ad76501d765c8cf8c0804d2cb0fcb0fcbffcbff71f90400cf0bff5003fa0281008dcf0b7017cccc15ccc971fb00039aa401c8cecb3fcec9ed54925f03e201fe31ed44d0fa40d33f20d431d74cf89224c705f2e1917005d33f31f405eb8040f4966fa59e5f043301c8cecb3fcec9ed54db31e107a4208100fab9f2e18f81019121a05386bbf2f401fa00d4d1f82829c8cb3fcec925c8cf89880153125cf90001f9005ad76501d765c8cf8c0804d2cb0fcb0fcbffcbff71f90400cf0bff5004050032fa0281008dcf0b7013cc12ccccc971fb005164ba9303a403de003631ed44d0fa40f89258c705f2e19101d33f31fa4030c8cecec9ed54020120080d020120090a0033b8b5d31ed44d0d74cd0d431d74cd0c8ceccc9d0c8cf8406cec980201200b0c0027b5dafda89a1a863a863ae99a1a61fa61ff481a300073b4f47da89a1a863ae99f0500591967e259d92b9f20003f200b5aeca03aecb919f181009a5961f961f97ff97fee3f20801919f14008197ff93a10001fbc82df6a2687d20699feba6686ba62c449c5649a",
        ),
    )
    it(
        "should compile Wallet V5",
        test(
            readFileSync(path.join(__dirname, "testdata", "wallet_v5.now.fif"), "utf8"),
            "b5ee9c7241021301000294000114ff00f4a413f4bcf2c80b01020120021202014803090202ce040501e1420d749c120915b8ee620d70b1f2082106578746ebd21821073696e74bdb0925f03e082106578746eba8eb58020d72101d074d721fa4030fa44f828fa443058bd915be0ed44d0810141d721f404308307f40e6fa1319130e18040d721707fdb3ce03120d749810280b99130e070f002e280601d74218308d722028308d723208020d721d31fd31fd31fed44d0d200d31f20d31fd3fff404300af90140ccf9109910895f0993f2c087e0e102b3076eb317b0f2d0845125baf2e0855036baf2e086f823bbf2d0882292f800de01a471c8cb00cb1fcec9ed542092f80fde70db3c80602e8eda2edfb02f404216e926c218e4c21d73930709421c700b38e2d01d72820761e436c20d749c008f2e09320d74ac002f2e09320d71d06c712c2005250b0f2d089d74cd7393001a4e834038407bbf2e09302d74ac000f2e093ed55e2d20001915be1eb20d72c0814e30f20d74a935bdb31e1d74cd007080060fa4030fa44f828fa443058baf2e091ed44d0810141d718f40430830771c8cb00034444f453f2e08b01c8cef400c9ed5400f4d72c081c8e38fa4030fa44f828fa443058baf2e091ed44d0d200810140d718f40430138307f45bf2e08c2196206eb3f2e090df01c8ca0012cef400c9ed548e39d72c082493f2c08de122f2e092ed44d001d2003001d20020810140d721f404305123bdf2e08f22913196016eb3f2e08ee201c8ca00cec9ed54e20201200a110201200b0e02016e0c0d0019adce76a2684020eb90e9ff98400019af1df6a2684010eb90e98f98400201480f100017b325fb51341c75c874c7cc200011b262fb513434800c20001bbe5f0f6a2684080a0eb90fa021840024f220d70b1f82107369676ebaf2e08a7ff002b561f36c",
        ),
    )
})
